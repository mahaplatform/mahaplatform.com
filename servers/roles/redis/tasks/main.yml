- name: extract redis
  unarchive:
    src: https://s3.amazonaws.com/ansible.mahaplatform.com/redis-4.0.0.tar.gz
    dest: /home/centos
    remote_src: yes

- name: build redis dependencies
  shell:
    cmd: 'bash -lc "make hiredis jemalloc linenoise lua geohash-int"'
  args:
    chdir: /home/centos/redis-4.0.0/deps

- name: build redis
  shell:
    cmd: 'bash -lc "make && make install"'
  args:
    chdir: /home/centos/redis-4.0.0

- name: copy redis-setup.sh
  copy:
    src: ../files/redis-setup.sh
    dest: /home/centos/redis-4.0.0/utils/redis-setup.sh
    mode: 0755

- name: run redis setup
  shell:
    cmd: 'bash -lc "./redis-setup.sh"'
  args:
    chdir: /home/centos/redis-4.0.0/utils
