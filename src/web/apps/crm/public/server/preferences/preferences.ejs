<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" type="text/css" href="/admin/css/semantic.min.css">
    <title><%= program.get('title') %> Email Preferences for <%= contact.get('full_name') %></title>
    <style>
      body {
        position: relative;
      }
      .overlay  {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0,0,0,.03);
        padding: 0.8em;
      }
      .panel {
        border: 1px solid rgba(0,0,0,.05);
        background-color: rgba(255, 255, 255, 1);
        padding: 0.8em;
        margin: 0 auto;
        width: 100%;
        max-width: 470px;
        margin-bottom: 1.8em;
      }
      .address {
        margin-bottom: 1.8em;
      }
      .subscription {
        margin-bottom: 0.8em;
      }
      .unsubscribe {
        margin-bottom: 1.8em;
      }
      .forwarded {
        margin-bottom: 1.8em;
        text-align: center;
      }
      .copyright {
        text-align: center;
        color: rgba(0, 0, 0, 0.6);
      }
      p {
        line-height: 1.8em !important;
      }
    </style>
  </head>
  <body>

    <div class="overlay">

      <div class="preferences">

        <div class="panel">

          <form method="post" action="/crm/preferences/<%= consent.get('code') %>" class="ui form">

            <h1><%= program.get('title') %></h1>

            <p><strong>Email Preferences for <%= contact.get('full_name') %></strong></p>

            <div class="address" class="ui field">
              <label>Subscribed email address</label>
              <input id="email" value="<%= email_address.get('address') %>" />
            </div>

            <div class="subscriptions">
              <p>I am interested in the following lists:</p>
              <% lists.map(list => { %>
                <div class="subscription">
                  <div class="ui checkbox">
                    <input class="list" id="list-<%= list.get('id') %>" name="subscriptions[]" type="checkbox"<%- list.get('is_subscribed') ? ' checked="checked"' : '' %> value="<%= list.get('id') %>" />
                    <label for="list-<%= list.get('id') %>">
                      <%= list.get('name') %>
                    </label>
                  </div>
                </div>
              <% }) %>
            </div>

            <div class="ui divider"></div>

            <div class="unsubscribe">
              <div class="ui checkbox">
                <input id="unsubscribe" name="unsubscribe" type="checkbox" value="1"<%- consent.get('unsubscribed_at') !== null ? ' checked="checked"' : '' %> />
                <label for="unsubscribe">
                  Please unsubscribe the email address below from all future mailings
                </label>
              </div>
            </div>

            <div class="forwarded">
              <p><%= email_address.get('address') %></p>
              <p><strong>Not your email address?</strong></p>
              <p>
                This email message may have been forwarded to you from a friend or
                colleague. Please contact them directly to stop receiving forwarded emails
              </p>
            </div>

            <button class="ui blue button">Update</button

          </form>

        </div>

        <div class="copyright">
          &copy; Copyright <%= program.get('title') %> <%= moment().format('YYYY') %>
        </div>

      </div>

    </div>

    <script>

      const unsubscribe = document.getElementById('unsubscribe')

      const lists = document.getElementsByClassName('list')

      const email = document.getElementById('email')

      email.onfocus = function() {
        email.blur()
      }

      Array.prototype.map.call(lists, list => {
        list.onclick = function() {
          unsubscribe.checked = false
        }
      })
      unsubscribe.onclick = function() {
        Array.prototype.map.call(lists, list => {
          list.checked = false
        })
      }
    </script>

  </body>

</html>
